<html lang="ko">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<script>
        /*
		 	ex_07 todolist ì—ì„œ ì¶”ê°€
		 	- ìˆ˜ì •ì‹œì—ëŠ” ëª¨ë‹¬ì°½ì´ ëœ¨ë„ë¡ ìˆ˜ì •

		 	* ì°¸ê³ : localStorage ê³µê°„ì´ ex_06ì™€ ê°™ì•„ì„œ ë°ì´í„° ì—°ë™ë˜ì–´ìˆìŒ!
	    */
        document.addEventListener("DOMContentLoaded", function () {
            const input = document.getElementById('todoInput'); // í…ìŠ¤íŠ¸ ìƒì
            const addButton = document.getElementById('addButton'); // ì¶”ê°€ ë²„íŠ¼
            const clearButton = document.getElementById('clearButton'); // ì„ íƒ ì‚­ì œ ë²„íŠ¼
            const clearAllButton = document.getElementById('clearAllButton'); // ëª¨ë‘ ì‚­ì œ ë²„íŠ¼
            const todoList = document.getElementById('todoList'); // ë¦¬ìŠ¤íŠ¸

            // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            let list = JSON.parse(localStorage.getItem('TodoList')) || []; // JSON ì´ null ì´ë©´ ë¹ˆë°°ì—´ ìƒì„±

            // ë°ì´í„° ì°¾ê¸°
            const findData = (value) => {
                let isData = false;
                list.forEach((item) => {
                    if (item === value) {
                        isData = true; // ê°’ì´ ì¡´ì œí•˜ë©´ true ë¡œ ë³€ê²½
                    }
                });
                return isData;
            }

            // ì²´í¬ ë°•ìŠ¤ ì„ íƒìœ ë¬´ ìŠ¤íƒ€ì¼ ë³€ê²½ ë° ë”ë¸”í´ë¦­ ì²˜ë¦¬
            const checkBoxToggle = (li, index) => {
                const checkbox = li.querySelector('input');
                let isChecked = false;
                // ì²´í¬ë°•ìŠ¤ ìƒíƒœì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ë³€ê²½
                checkbox.addEventListener('change', (e) => {
                    isChecked = e.target.checked;
                    if (isChecked) {
                        li.style.textDecorationLine = 'line-through';
                        li.style.fontStyle = 'italic';
                        li.style.color = '#b3b3b3';
                    } else {
                        li.style.fontStyle = 'normal';
                        li.style.textDecoration = 'none';
                        li.style.color = 'black';
                    }
                });

                // ëª¨ë‹¬ ì°½ ì¡°ì ˆ (ì²´í¬ê°€ ì•ˆë˜ì–´ìˆì„ ê²½ìš°ë§Œ ì‹¤í–‰!)
                const modal = document.getElementById('modal');
                const button = document.getElementById('editButton');
                const modalInput = document.getElementById('todoEdit');
                const closeButton = document.getElementById('closeModal');
                li.querySelector('#value').addEventListener('click', () => {
                    	   if(!isChecked) { // ì²´í¬ ìœ ë¬´ í™•ì¸ -> ì•ˆë˜ì–´ìˆì„ ê²½ìš°ë§Œ ì‹¤í–‰
                               modal.style.display = 'flex'; // ëª¨ë‹¬ì°½ ë³´ì´ë„ë¡ ì„¤ì •
                               button.addEventListener('click', () => {
                                   // ì˜ˆì™¸ì²˜ë¦¬: ê°’ì´ ì…ë ¥ì´ ì•ˆëœê²½ìš°
                                   if(modalInput.value === '') {
                                       alert('ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                                       return;
                                   }
                                   let value = modalInput.value;
                                   list.splice(index, 1,value); // ê°’ ë³€ê²½ splice(ì¸ë±ìŠ¤,ë³€ê²½ê°¯ìˆ˜, ê°’);
                                   localStorage.setItem('TodoList', JSON.stringify(list)); //ë¦¬ìŠ¤íŠ¸ ì—…ê·¸ë ˆì´ë“œ
                                   alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                                   modal.style.display = 'none'; //ìˆ˜ì •í›„ ëª¨ë‹¬ì°½ ì•ˆë³´ì´ê²Œ ì„¤ì •
                                   modalInput.value = '';
                                   todoList.innerHTML = '';
                                   showList();
                                   console.log(`updated :) [ ADD: ${value} (${index})]`);
                               });
                           }

                           // X í´ë¦­ì‹œ ëª¨ë‹¬ì°½ ì•ˆë³´ì´ë„ë¡ ì„¤ì •
                          closeButton.addEventListener('click', () => {
                             modal.style.display = 'none';
                             modalInput.value = '';
                          });
                });
            }



            // ë°ì´í„° ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
            const showList = () => {
                // ê¸°ì¡´ ë°ì´í„°ë¡œ í™”ë©´ì— li ì¶”ê°€
                list.forEach((item,index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `<input type="checkbox" id="checkBox" data-idx="${index}"><span id="value"> ${item}</span>`;
                    checkBoxToggle(li, index); // ì²´í¬ ë°•ìŠ¤ ì„ íƒì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ë³€ê²½
                    todoList.appendChild(li);
                });
            }

            // Add ë²„íŠ¼ í´ë¦­ ì‹œ
            addButton.addEventListener('click', function () {
                const value = input.value.trim(); // ë¹ˆì¹¸ì œê±° í›„ ì €ì¥
                // ì˜ˆì™¸ì²˜ë¦¬: ë¦¬ìŠ¤íŠ¸ì— ì´ë¯¸ ì¡´ì œí•˜ëŠ” ê²½ìš°
				if (findData(value)) {
					alert('ë¦¬ìŠ¤íŠ¸ê°€ ì´ë¯¸ ì¡´ì œí•©ë‹ˆë‹¤!');
                    return;
                }
                // ì˜ˆì™¸ì²˜ë¦¬: íƒìŠ¤íŠ¸ìƒìì— ê°’ì´ ì—†ëŠ”ê²½ìš°
                if (value === ''){
                    alert('ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }
                const li = document.createElement('li');
                let index = list.length;
                li.innerHTML = `<input type="checkbox" id="checkBox" data-idx="${index}"><span id="value"> ${value}</span>`; // ì¸ë±ìŠ¤ ë²ˆí˜¸ ì¶”ê°€ë¥¼ ìœ„í•´ data-idx ì¶”ê°€
                checkBoxToggle(li,index); // ì²´í¬ ë°•ìŠ¤ ì„ íƒì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ë³€ê²½
                todoList.appendChild(li);
                list.push(value); //ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
                localStorage.setItem('TodoList', JSON.stringify(list)); //ë¦¬ìŠ¤íŠ¸ ì—…ê·¸ë ˆì´ë“œ
                console.log(`updated :) [ UPDATE: ${value} (${li.querySelector('input').getAttribute('data-idx')})]`);
                input.value = ''; // íƒìŠ¤íŠ¸ìƒì ë¹„ìš°ê¸°
            });

            // Clear ë²„íŠ¼ í´ë¦­ì‹œ
            clearButton.addEventListener('click', function () {
                const value = input.value.trim(); // íƒìŠ¤íŠ¸ ìƒìì— ì…ë ¥ëœ ê°’ì„ ë¶ˆëŸ¬ì˜´
                // ì˜ˆì™¸ì²˜ë¦¬: íƒìŠ¤íŠ¸ìƒìì— ê°’ì´ ì—†ëŠ”ê²½ìš°
                if (value === ''){
                    alert('ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }
                // ê°’ì´ ì¡´ì œí•˜ëŠ” ê²½ìš° ì œê±°
                if(findData(value)){
                    list.splice(list.indexOf(value), 1);
                    localStorage.setItem('TodoList',JSON.stringify(list));
                    console.log(`updated :) [ DELETE: ${value}]`);
                    input.value = '';
                    todoList.innerHTML =''; // ê¸°ì¡´ li ì œê±°
                    showList(); // ë¦¬ìŠ¤íŠ¸ ì¬ì¶œë ¥
                    return;
			   }
                alert(`${value}ê°€ ë¦¬ìŠ¤íŠ¸ì— ì¡´ì œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!`);
            });

            // ClearAll ë²„íŠ¼ í´ë¦­ ëª¨ë‘ ì‚­ì œ
            clearAllButton.addEventListener('click', function () {
                if(confirm('ì •ë§ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? \nì‚­ì œí›„ì—ëŠ” ë³µêµ¬ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')){
                    // ìš”ì†Œ ì´ˆê¸°í™”
                    localStorage.clear();
                    todoList.innerHTML = '';
                    list = [];
                    input.value = '';
                    alert("ëª¨ë‘ ì‚­ì œ ë˜ì—ˆìŠµë‹ˆë‹¤!");
                    console.log(`successfully cleared :)`);
				}
            });

			showList();
        });
	</script>
	<style>
		*{ margin: 0; padding: 0;  box-sizing: border-box; }

		body{
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			background-color: #aacaef;
		}
		h1{
			font-size: 44px;
		}

		div input{
			width: 500px;
			height: 50px;
			border-radius: 10px;
			text-align: center;
			font-size: 20px;
		}
		div button{
			width: 100px;
			height: 50px;
			text-align: center;
			border-radius: 5px;
        }

		ul{
			background-color: white ;
			width: 1000px;
			height: 700px;
			overflow-y: scroll;
			padding: 20px;
			display: flex;
			flex-direction: column;
			align-items: center;
		}
		li{
			list-style: none;
			font-size: 30px;
		}

		input[type="checkbox"]{
			width: 20px;
			height: 20px;
		}


		/* Modal Style */
		#modal{
			position: absolute;
			top: 0;
			width: 100%;
			height: 100vh;
			background-color: rgba(0, 0, 0, 0.8);
			display: none;
			justify-content: center;
			align-items: center;
		}



	</style>
</head>
<body>
<h1>My To-Do List</h1>
<div>
	<label for="todoInput"></label><input type="text" id="todoInput" placeholder="Add a new task">
	<button id="addButton">â•Add</button>
	<button id="clearButton">ğŸ”Clear</button>
	<button id="clearAllButton">âŒClear All</button>
</div>
<ul id="todoList"></ul>

<div id="modal">
	<label for="TodoEdit"></label><input id="todoEdit" type="text"><button id="editButton">ìˆ˜ì •</button>
	<button id="closeModal">X</button>
</div>
</body>
</html>